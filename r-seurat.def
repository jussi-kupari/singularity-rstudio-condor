Bootstrap: docker
From: rocker/tidyverse:latest

# Uncomment below for adding locally installed packages to rebuilt container
 %files
# Create the install_local_packages.R using the 
# extract_package_info / generate_install_script functions
# install_local_packages.R /install_local_packages.R

%post
    # Update and install system dependencies
apt-get update && apt-get install -y --no-install-recommends \
        libxml2-dev \
        libcurl4-openssl-dev \
        libssl-dev \
        libgit2-dev \
        libfontconfig1-dev \
        libharfbuzz-dev \
        libfribidi-dev \
        libhdf5-dev \
        libgeos-dev \
        libproj-dev \
        libgdal-dev \
        libudunits2-dev \
        libnode-dev \
        libcairo2-dev \
        libxt-dev \
        libglpk-dev \
        build-essential \
        cmake \
        pkg-config \
        gfortran \
        libblas-dev \
        liblapack-dev \
        libffi-dev \
        zlib1g-dev \
        libbz2-dev \
        liblzma-dev \
        libncurses5-dev \
        libreadline-dev \
        libsqlite3-dev \
        wget \
        curl \
        bzip2

    # Remotes for installing from Github, GitLab, Bitbucket etc.
    R -e "install.packages('remotes', repos='https://cloud.r-project.org/')"

    # Install Seurat
    R -e "install.packages('Seurat', repos='https://cloud.r-project.org/')"

    # Install project local packages to rebuilt container
    # These are libraries found in R_libs outside the container
    # Uncomment below to install libraries inside the container
    # Rscript /install_local_packages.R 

    # Clean up
    apt-get clean
    rm -rf /var/lib/apt/lists/*

%environment
    export R_LIBS_USER="/project/R_libs"
    export LC_ALL=C

%runscript
    exec "$@"

%labels
    Author YourName
    Version 1.0
    Description R container with RStudio, tidyverse, and Seurat
